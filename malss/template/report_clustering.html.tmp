<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Analysis report</title>
</head>

<body>
	<h1 id="top">Results</h1>

	<table border="1" cellspacing="0" cellpadding="5">
		<tr>
			<th rowspan=2>Algorithms</th>
			<th colspan=4>Estimated number of clusters</th>
		</th>
		<tr>
			<th>Gap statistic</th>
			<th>Silhouette score</th>
			<th>Davies-Bouldin score</th>
			<th>Calinski and Harabasz score</th>
		</tr>

	{%- for algorithm in algorithms %}
		<tr>
			<td><a href="#{{ algorithm.name }}">{{ algorithm.name }}</a></td>
			<td>{{ algorithm.results['gap_nc'] }}</td>
			<td>{{ algorithm.results['silhouette_nc'] }}</td>
			<td>{{ algorithm.results['davies_nc'] }}</td>
			<td>{{ algorithm.results['calinski_nc'] }}</td>
		</tr>
	{%- endfor %}
	</table>
	<p>
	According to the majority rule, the estimated number of clusters is <strong>{{ nc }}</strong>.
	</p>
	<br>

	<h2>Clustering <font size="-1">[<a href="#top">Back To Top</a>]</font></h2>
	<p>
		<ul>
			<li>Clustering is the task of grouping a set of data samples in such a way that samples in the same group are more similar to each other than to those in other groups.</li>
			<li>In general, data samples have no labels so that we <strong>need to interpret the results of clustering</strong>.</li>
			<li>Many clustering algorithms need to set the number of clusters.</br>
			    However, the optimal number of clusters is unknown.</br>
				Therefore, MALLS conducts the cluster analysis with a range of candidates of the number of clusters.
			</li>
			<li>A wide variety of indices have been proposed to find the optimal number of clusters.</br>
			    MALSS <strong>estimates the optimal number of clusters by majority vote</strong> of these indices.
			</li>
			<li>The indices that MALSS uses are as follows: 
			    <a href="https://statweb.stanford.edu/~gwalther/gap" target="new">Gap statistic</a>，
				<a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.silhouette_score.html" target="new">Silhouette score</a>，
				<a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.davies_bouldin_score.html" target="new">Davies-Bouldin score</a>，
				<a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.calinski_harabasz_score.html" target="new">Calinski and Harabasz score</a>.
			</li>
		</ul>
	</p>
	<hr>

	<h2>Data summary <font size="-1">[<a href="#top">Back To Top</a>]</font></h2>
	<ul>
		<li>Number of rows: {{ data.shape_before[0] }}</li>
		<li>Number of columns: {{ data.shape_before[1] }} (numerical: {{ data.shape_before[1] - data.del_columns|length }}, categorical: {{ data.del_columns|length }})</li>
		{%- if data.del_columns|length > 0 %}
		<ul>
			<li>Categorical values were encoded to integer features using a <a href="http://scikit-learn.org/stable/modules/preprocessing.html#encoding-categorical-features">one-of-K scheme</a>.</li>
		</ul>
		{%- endif %}
		{%- if data.col_was_null|length > 0 %}
		<li>Column {% for col in data.col_was_null %}{{ col }} {% endfor %}had NA values.</li>
		<ul>
			<li>NA values were filled in with the most frequent value (categorical), median (integer), mean (float).</li>
			<li>See also: <a href="http://pandas.pydata.org/pandas-docs/stable/missing_data.html">missing data</a></li>
		</ul>
		{%- endif %}
	</ul>
	<details>
	<summary><font size="+1"><strong>Descriptions (click here)</strong></font></summary>
	<ul>
		<li>クラスタリングはサンプル間の距離をみることが多いため，特徴量ごとの大きさが大きく異なっている（例えば特徴量１は身長[m]で1桁のオーダー，特徴量２は体重[g]で5桁のオーダー）と上手くクラスタリングできないことがあります（数値の小さい身長の影響が無視されてしまう）．<br>そこで，MALSSの初期設定では各特徴量を平均が0，分散が1になるように<strong>標準化</strong>しています．標準化が不要な場合は，コンストラクタの引数を <i>standardize=False</i> にしてください．</li>
		<li>Note that some features (e.g. country code) may have to be handled as the categorical feature even though they look like numerical features. In such case, you need to encode categorical features into numerical features using a <a href="http://scikit-learn.org/stable/modules/preprocessing.html#encoding-categorical-features">one-of-K scheme</a> by yourself before setting data to MALSS.</li>
	</ul>
	</details>
	<hr>

	<h2 id="{{ algorithms[0].name }}"><a href="{{ algorithms[0].link }}">k-means clustering</a> <font size="-1">[<a href="#top">Back To Top</a>]</font></h2>
	<p>
		<ul>
			<li><a href="https://ja.wikipedia.org/wiki/K%E5%B9%B3%E5%9D%87%E6%B3%95" target="new">k-meansクラスタリング</a>は最もポピュラーなクラスタリングアルゴリズムの１つです．</li>
			<li>k-meansクラスタリングは，<strong>各クラスタのサイズが同じである</strong>ことを仮定していることに注意が必要です．この仮定が妥当でないデータにk-meansクラスタリングを適用した場合，望ましいクラスタリング結果が得られない可能性があります．</li>
		</ul>
	</p>

	<h3>Gap statistics</h3>
	<img border="0" src="gap_{{ algorithms[0].estimator.__class__.__name__ }}.png" height="300" alt="gap_statistics">

	<h3>Silhouette score</h3>
	<img border="0" src="silhouette_{{ algorithms[0].estimator.__class__.__name__ }}.png" height="300" alt="silhouette_score">
    
	<h3>Davies-Bouldin score</h3>
	<img border="0" src="davies_{{ algorithms[0].estimator.__class__.__name__ }}.png" height="300" alt="davies_bouldin_score">
    
	<h3>Calinski and Harabasz score</h3>
	<img border="0" src="calinski_{{ algorithms[0].estimator.__class__.__name__ }}.png" height="300" alt="calinski_harabasz_score">
    
	<h2 id="{{ algorithms[1].name }}"><a href="{{ algorithms[1].link }}">Hierarchical clustering</a> <font size="-1">[<a href="#top">Back To Top</a>]</font></h2>
	<p>
		<ul>
			<li><a href="https://en.wikipedia.org/wiki/Hierarchical_clustering" target="new">階層的クラスタリング</a>は，k-meansクラスタリングと並んで最もポピュラーなクラスタリングアルゴリズムの１つです．</li>
			<li>階層的クラスタリング手法は，<strong>データ一つ一つを順次併合していく凝集型（agglomerative）</strong>と，<strong>データ全体を順次分割していく分割型（divisive）</strong>に大別されます．</br>
			    MALSSでは凝集型階層的クラスタリングをサポートしています．
            </li>
			<li>階層的クラスタリングには，分析結果を<strong>デンドログラム（dendrogram）</strong>という樹形図で可視化できるという利点があります．</br>
			    しかし，デンドログラムを見る際には，以下の点に注意する必要があります．
				<ul>
					<li>デンドログラムの縦軸はクラスタ間の距離を表すが，横軸の描画方法には任意性があり<strong>近くのデータと類似しているとは限らない</strong>．</li>
					<li>デンドログラムは常に階層構造を示すが，<strong>データに本当にそのような階層構造が存在するとは限らない</strong>．</li>
					<li>デンドログラムの形状はクラスタ間の距離の計算方法（linkage criteria）に強く依存します．</br>MALSSではlinkage criteriaに完全連結法（complete linkage method）を採用しています．</li>
				</ul>
            </li>
		</ul>
	</p>

	<h3>Dendrogram</h3>
	<img border="0" src="dendrogram_{{ algorithms[1].estimator.__class__.__name__ }}.png" height="400" alt="dendrogram">

	<h3>Gap statistics</h3>
	<img border="0" src="gap_{{ algorithms[1].estimator.__class__.__name__ }}.png" height="300" alt="gap_statistics">

	<h3>Silhouette score</h3>
	<img border="0" src="silhouette_{{ algorithms[1].estimator.__class__.__name__ }}.png" height="300" alt="silhouette_score">
    
	<h3>Davies-Bouldin score</h3>
	<img border="0" src="davies_{{ algorithms[1].estimator.__class__.__name__ }}.png" height="300" alt="davies_bouldin_score">
    
	<h3>Calinski and Harabasz score</h3>
	<img border="0" src="calinski_{{ algorithms[1].estimator.__class__.__name__ }}.png" height="300" alt="calinski_harabasz_score">
    
</body>
</html>